# 星宫插件（观星台 + 周天星斗大阵）_20260218

## 目标
- 自动观星台：周期发送 `.观星台`，解析引星盘状态；异常则 `.安抚星辰`；成熟则 `.收集精华`；空闲盘位用 `.牵引星辰 <星辰>`（自动填补空白）补满；下一次检查按最短“剩余”时间提前（复用小药园思路）。
- 周天星斗大阵：按配置时间定时发送 `.启阵`；看到他人“启阵邀请”自动发送 `.助阵`（按你确认：无需回复启阵人）。

## 非目标
- 暂不做星辰轮换/多星策略（先单一星辰）。
- 暂不做复杂状态机；以“解析状态 -> 一键指令 -> 失败容错”为主。

## 需求确认（已确认）
- 星辰默认：`庚金星`（必须可在配置中修改）。
- 观星台补满策略：默认填补所有空闲引星盘，不限制数量（类似小药园）。
- 异常处理：自动执行 `.安抚星辰`。
- 启阵策略（核心）：
  - 每天 07:00 开始尝试 `.启阵`
  - 若未“成功”，每 2 分钟重试，直到成功
  - 第二次从“第一次成功时间 + 12 小时 5 分钟”开始尝试，同样每 2 分钟重试，直到成功
  - 需要监听“阵成通知”（该通知可能是对原启阵消息的编辑）
  - `.助阵` 仅需发送 `.助阵`（不需要 reply）

## 任务清单
- [x] 增加配置项与 `.env.example`
- [x] 新增观星台解析器（剩余时间/空闲/异常/可收集）
- [x] 实现 `xiuxian_bot/plugins/xinggong.py`（观星台自动化 + 启阵定时 + 自动助阵）
- [x] 在 `xiuxian_bot/app.py` 注册插件，并在启动时 bootstrap 一次 `.观星台` + 注册定时
- [x] 增加 TG MessageEdited 监听（用于阵成通知/日志/解析）
- [x] 增加最小化解析测试/脚本，覆盖你提供的样例回包
